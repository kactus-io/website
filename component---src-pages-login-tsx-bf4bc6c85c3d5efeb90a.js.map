{"version":3,"sources":["webpack:///./src/components/banner.tsx","webpack:///./src/hooks/useUser.ts","webpack:///./src/pages/login.tsx","webpack:///./src/components/loader.tsx"],"names":["Banner","message","error","onClose","id","onClick","isAdmin","user","org","admins","indexOf","githubId","parseUser","userString","token","query","JSON","parse","orgs","length","find","o","adminOrgs","filter","bind","this","currentOrg","useUser","location","React","useState","_setUser","loading","setLoading","search","slice","split","reduce","prev","x","parts","decodeURIComponent","setUser","localStorage","stringify","undefined","navigate","useEffect","parsed","SignUp","fromOrg","className","href","Login","setRawUser","loadingAuthentication","setLoadingAuthentication","banner","setBanner","signupFromOrg","code","fetch","API_ROOT","state","then","res","ok","json","Error","catch","err","Loader"],"mappings":"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","file":"component---src-pages-login-tsx-bf4bc6c85c3d5efeb90a.js","sourcesContent":["import React from 'react'\n\nimport './banner.css'\n\nconst Banner = ({\n  message,\n  error,\n  onClose,\n}: {\n  message: string\n  error?: boolean\n  onClose: () => void\n}) => {\n  if (error) {\n    return (\n      <div id=\"error-banner\">\n        <div id=\"error-content\">{message || 'There was an error...'}</div>\n        <div id=\"close-error-banner\" onClick={onClose}>\n          x\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div id=\"success-banner\">\n      <div id=\"success-content\">{message || 'Success!'}</div>\n      <div id=\"close-success-banner\" onClick={onClose}>\n        x\n      </div>\n    </div>\n  )\n}\n\nexport default Banner\n","import React from 'react'\nimport { navigate } from 'gatsby'\n\nimport { User, Org } from '../types'\n\nfunction isAdmin(user: User, org: Org) {\n  return org.admins.indexOf(user.githubId) !== -1\n}\n\nfunction parseUser(\n  userString: string,\n  token: string,\n  query: { org?: string }\n): User | undefined {\n  const user = {\n    ...JSON.parse(userString),\n    token: token,\n  } as User\n\n  if (user.orgs && user.orgs.length) {\n    const orgs = user.orgs\n\n    let org: Org\n    if (query.org) {\n      org = orgs.find(o => o.id === query.org)\n    } else {\n      const adminOrgs = orgs.filter(isAdmin.bind(this, user))\n      if (adminOrgs.length === 1) {\n        org = adminOrgs[0]\n      } else if (orgs.length === 1) {\n        org = orgs[0]\n      }\n    }\n\n    user.currentOrg = org\n  }\n  return user\n}\n\nexport default function useUser(\n  location: Location\n): [\n  User | null,\n  boolean,\n  (arg: User | null) => void,\n  (user: string, token: string, query: { org?: string }) => void\n] {\n  const [user, _setUser] = React.useState<User | null>(null)\n  const [loading, setLoading] = React.useState(true)\n\n  const query = location.search\n    ? location.search\n        .slice(1)\n        .split('&')\n        .reduce<{ org?: string; code?: string; state?: string }>((prev, x) => {\n          const parts = x.split('=')\n          prev[parts[0]] = decodeURIComponent(parts[1])\n          return prev\n        }, {})\n    : {}\n\n  const setUser = (user: User | null) => {\n    if (user) {\n      localStorage.user = JSON.stringify({\n        ...user,\n        token: undefined,\n        currentOrg: undefined,\n      })\n      localStorage.token = user.token\n    } else {\n      delete localStorage.user\n      delete localStorage.token\n      navigate('/login')\n    }\n    _setUser(user)\n  }\n\n  const setRawUser = (user: string, token: string, query: { org?: string }) => {\n    const parsed = parseUser(user, token, query)\n    setUser(parsed)\n  }\n\n  React.useEffect(() => {\n    if (localStorage.user && localStorage.token) {\n      const user = parseUser(localStorage.user, localStorage.token, query)\n      setUser(user)\n      setLoading(false)\n    } else {\n      setLoading(false)\n    }\n  }, [])\n\n  return [user, loading, setUser, setRawUser]\n}\n","import React from 'react'\nimport { navigate } from 'gatsby'\n\nimport Layout from '../components/layout'\nimport SEO from '../components/seo'\nimport Header from '../components/header'\nimport Loader from '../components/loader'\nimport Banner from '../components/banner'\n\nimport useUser from '../hooks/useUser'\n\nimport './pricing.css'\nimport './org.css'\n\nconst API_ROOT = process.env.GATSBY_API_ROOT\nconst GITHUB_CLIENT = process.env.GATSBY_GITHUB_CLIENT\n\nconst SignUp = ({ fromOrg }: { fromOrg: boolean }) => {\n  return (\n    <div className=\"centered-section\">\n      {fromOrg ? (\n        <div>\n          <p>\n            An organization allows you to centralize the licenses for the\n            designers in your team.\n          </p>\n          <p>\n            Both you and the people in your team need to be Kactus users before\n            creating an organization.\n          </p>\n        </div>\n      ) : null}\n      <a\n        className=\"cta primary\"\n        href={`https://github.com/login/oauth/authorize?client_id=${GITHUB_CLIENT}`}\n      >\n        Sign up with Github\n      </a>\n      <a\n        className=\"cta\"\n        href=\"https://github.com/kactus-io/kactus/releases/latest/download/Kactus-macos.zip\"\n      >\n        Download Kactus for macOS\n      </a>\n    </div>\n  )\n}\n\nconst Login = ({ location }: { location: Location }) => {\n  const [user, loading, setUser, setRawUser] = useUser(location)\n  const [loadingAuthentication, setLoadingAuthentication] = React.useState(\n    false\n  )\n  const [banner, setBanner] = React.useState<{\n    message: string\n    error?: boolean\n  } | null>(null)\n\n  const query = location.search\n    ? location.search\n        .slice(1)\n        .split('&')\n        .reduce<{ org?: string; code?: string; state?: string }>((prev, x) => {\n          const parts = x.split('=')\n          prev[parts[0]] = decodeURIComponent(parts[1])\n          return prev\n        }, {})\n    : {}\n\n  React.useEffect(() => {\n    if (user) {\n      const signupFromOrg = localStorage.signupFromOrg\n      delete localStorage.signupFromOrg\n      navigate(signupFromOrg ? '/org' : '/account')\n      return\n    }\n    if (!loading && !user && query.code) {\n      setLoadingAuthentication(true)\n      fetch(\n        `${API_ROOT}/oauth/github/authenticate?code=${query.code}&state=${query.state}`\n      )\n        .then(res => {\n          if (!res.ok) {\n            return res.json().then(function(parsed) {\n              throw new Error(parsed.message)\n            })\n          }\n          return res.json()\n        })\n        .then(res => {\n          setRawUser(JSON.stringify(res.user), res.token, query)\n          setLoadingAuthentication(false)\n        })\n        .catch(err => {\n          setBanner({ message: err.message, error: true })\n          setLoadingAuthentication(false)\n        })\n    }\n  }, [loading, loadingAuthentication])\n\n  return (\n    <Layout>\n      <SEO />\n      <Header />\n      {loading || loadingAuthentication ? (\n        <Loader />\n      ) : !user ? (\n        <SignUp fromOrg={localStorage.signupFromOrg} />\n      ) : null}\n\n      {banner ? <Banner {...banner} onClose={() => setBanner(null)} /> : null}\n\n      <hr />\n    </Layout>\n  )\n}\n\nexport default Login\n","import React from 'react'\n\nimport './loader.css'\n\nconst Loader = () => {\n  return (\n    <div id=\"loading\">\n      <div className=\"spinner\">\n        <div className=\"double-bounce1\"></div>\n        <div className=\"double-bounce2\"></div>\n      </div>\n    </div>\n  )\n}\n\nexport default Loader\n"],"sourceRoot":""}